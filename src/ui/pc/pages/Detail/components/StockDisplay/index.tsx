import style from "./index.module.css";
import {makeStyle} from "../../../../../../utils/CSSUtils";

import React, {useState, useRef, useEffect} from "react";
import {Types} from "aptos";

import {KChart} from "./KChart";
import {RTP, StockDatas, StockPrice} from "../../../../../../modules/stock/StockSlice";
import {stockMgr} from "../../../../../../modules/stock/StockManager";
import {useNavigate} from "react-router-dom";


const s = makeStyle(style);

function order(obj){
    const order = ["todayOpen", "yesterdayClose", "highest", "lowest","volume",
                   "amount","turnoverRate","ttm","per","circulationMarketValue",
                   "circulatingShares","mcap","zgb","ww52Highest","ww52Lowest"]
    return  order.map(key => obj[key]);
}


let noneDatas:StockDatas= {
    todayOpen:"0",
    yesterdayClose:"0",
    highest:"0",
    lowest:"0",
    volume:"0",
    amount:"0",
    turnoverRate:"0",
    ttm:"0",
    per:"0",
    circulationMarketValue:"0",
    circulatingShares:"0",
    mcap:"0",
    zgb:"0",
    ww52Highest:"0",
    ww52Lowest:"0",
}
let priceLibrary = [["2022-12-23",29.9,27.45,26.88,31.0,2.5182599E7],["2022-12-26",27.5,27.81,25.66,28.43,1.2604257E7],["2022-12-27",27.7,27.76,26.59,29.0,9255904.0],["2022-12-28",27.59,26.94,26.81,29.27,8756802.0],["2022-12-29",26.25,26.42,26.0,27.39,5274823.0],["2022-12-30",26.8,25.08,24.65,27.0,7561968.0],["2023-01-03",25.12,27.45,25.12,27.71,7629415.0],["2023-01-04",27.17,26.48,26.13,27.9,4874127.0],["2023-01-05",26.71,28.0,26.5,28.26,5854435.0],["2023-01-06",27.87,27.81,27.66,29.2,5774981.0],["2023-01-09",28.23,28.03,27.86,29.4,5113941.0],["2023-01-10",28.08,29.09,27.9,29.75,5269667.0],["2023-01-11",28.98,28.99,28.5,29.76,3179941.0],["2023-01-12",29.2,29.22,28.0,29.56,4029728.0],["2023-01-13",29.26,29.34,28.8,29.58,2237893.0],["2023-01-16",29.31,29.84,28.62,30.88,3591271.0],["2023-01-17",30.05,29.48,29.18,30.8,3715606.0],["2023-01-18",29.5,31.02,29.14,31.03,4134464.0],["2023-01-19",32.5,32.5,30.62,33.25,5269304.0],["2023-01-20",32.25,31.2,30.83,33.26,4049111.0],["2023-01-30",31.67,31.01,30.5,32.04,3668545.0],["2023-01-31",31.09,32.0,30.88,32.69,4400122.0],["2023-02-01",32.2,31.75,31.1,32.75,3836335.0],["2023-02-02",33.01,38.1,32.6,38.1,9221062.0],["2023-02-03",37.0,38.82,36.49,39.98,1.2755038E7],["2023-02-06",38.48,36.6,36.1,39.66,7395739.0],["2023-02-07",36.83,40.49,36.83,41.3,1.0607706E7],["2023-02-08",39.49,38.48,37.88,39.6,7085327.0],["2023-02-09",37.87,37.6,36.88,38.17,6440283.0],["2023-02-10",37.5,37.12,36.37,38.0,4690789.0],["2023-02-13",36.98,37.35,36.33,38.17,4653933.0],["2023-02-14",37.01,38.36,36.58,38.5,5301810.0],["2023-02-15",38.18,37.72,36.72,38.34,4389641.0],["2023-02-16",37.2,35.42,35.3,38.13,5159162.0],["2023-02-17",35.48,35.2,35.1,36.38,3341971.0],["2023-02-20",35.2,35.04,34.0,35.76,3337998.0],["2023-02-21",35.04,34.38,34.0,35.33,3262733.0],["2023-02-22",34.2,34.57,33.92,35.0,2075792.0],["2023-02-23",34.5,34.74,34.5,35.75,3151386.0],["2023-02-24",35.0,35.09,34.75,35.47,2402849.0],["2023-02-27",34.81,33.6,33.4,35.55,4341069.0],["2023-02-28",33.8,33.42,32.9,34.56,5071086.0],["2023-03-01",33.43,33.45,33.03,33.88,2831585.0],["2023-03-02",33.46,32.21,31.97,33.66,3769361.0],["2023-03-03",32.48,32.26,32.04,33.35,2536961.0],["2023-03-06",32.66,33.87,31.78,34.48,5115161.0],["2023-03-07",33.69,32.35,32.3,33.7,3152967.0],["2023-03-08",32.35,32.81,32.25,33.4,2022044.0],["2023-03-09",32.81,33.6,32.49,34.36,4259419.0],["2023-03-10",34.0,34.99,33.8,35.88,6623004.0],["2023-03-13",34.38,34.15,33.42,35.1,4031444.0],["2023-03-14",34.26,33.97,32.42,34.26,4053637.0],["2023-03-15",34.54,34.13,33.8,35.97,4605030.0],["2023-03-16",33.51,32.47,32.06,34.7,4084356.0],["2023-03-17",32.0,31.81,31.1,32.71,4293536.0],["2023-03-20",31.72,32.77,30.48,33.2,4612889.0],["2023-03-21",32.52,33.11,32.04,33.25,2354334.0],["2023-03-22",32.89,32.7,32.45,33.86,2661916.0],["2023-03-23",32.99,33.38,32.5,33.6,2667445.0],["2023-03-24",33.68,33.95,33.2,34.98,4477590.0],["2023-03-27",33.58,35.07,33.33,35.27,4228167.0],["2023-03-28",34.6,34.51,34.38,35.33,2808860.0],["2023-03-29",34.34,35.62,34.34,36.78,5245067.0],["2023-03-30",35.76,35.43,35.41,37.48,5569261.0],["2023-03-31",35.1,35.49,35.0,36.37,2871903.0],["2023-04-03",35.8,36.36,35.6,36.89,3790851.0],["2023-04-04",36.3,35.76,35.22,36.6,4011315.0],["2023-04-06",35.77,38.09,35.5,39.16,5983053.0],["2023-04-07",37.5,38.3,37.11,38.55,3767723.0],["2023-04-10",38.0,37.6,36.91,39.08,3178489.0],["2023-04-11",37.65,39.38,37.0,39.7,4463115.0],["2023-04-12",39.28,46.52,39.28,47.25,8538334.0],["2023-04-13",45.01,45.02,44.2,46.7,5258375.0],["2023-04-14",45.66,53.66,44.6,54.01,8870554.0],["2023-04-17",53.9,53.41,51.65,59.83,9605008.0],["2023-04-18",52.28,49.43,48.48,53.0,7180266.0],["2023-04-19",49.93,49.66,49.31,51.66,5834614.0],["2023-04-20",48.06,52.5,48.0,54.18,7204141.0],["2023-04-21",51.7,49.1,48.6,51.8,4297331.0]]

const names=["今开", "昨收", "最高", "最低", "成交量", "成交额", "换手率", "市盈(TTM)", "市净率", "流通值", "流通股", "总市值", "总股本", "52周高", "52周低"]

export function StockDisplay({code}) {
    const navigate=useNavigate()

    const [stockRTP,setStockRTP] = useState({
        price: "",
        abChange: "",
        reChange: "",
    })
    const [recommend,setRecommend] = useState<{strategy: number, degree: number,}>({
        strategy: null,
        degree: null,
    })
    const [isCollected,setIsCollected] = useState<{collect: boolean, hold: boolean}>({
        collect: null,
        hold: null
    })
    const [stockDatas,setStockDatas] = useState<StockDatas>(noneDatas);
    const [stockPrices,setStockPrices] = useState<StockPrice[]>([
        ["",null,null,null,null,null],
        ["",null,null,null,null,null],
        ["",null,null,null,null,null]
    ]);
    const [datas,setDatas] = useState<any[]>();

    useEffect(()=>{
        // @ts-ignore
        setStockPrices(priceLibrary);
        setDatas(order(noneDatas))

    },[])

    function handleCollect(type:number) {

    }

    // @ts-ignore
    return <div className={s('stockDisplay')}>
        <div className={s("title")}>
            <span>股票详情</span>
            {
                <div>
                    <button onClick={()=>handleCollect(0)}>{isCollected.collect?"已收藏":"+收藏"}</button>
                </div>
            }
        </div>

        <div className={s("top")}>
            <div className={s('RT-data', parseFloat(stockRTP.abChange)>0?"red":parseFloat(stockRTP.abChange)<0?"green":"")}>
                <span className={s('RT-price')}>{stockRTP.price}</span>
                <span>{stockRTP.abChange}</span>
                <span>{stockRTP.reChange}</span>
            </div>
        </div>


        <table>
            {datas?.map((value,index)=> {
                if (index % 5 === 0) {
                    return (
                        <tr key={index}>
                            {datas.slice(index, index + 5).map((value, subIndex) => (
                                <td key={subIndex}><span className={s('left')}>{names[index+subIndex]}：</span><span className={s('right')}>{value}</span></td>
                            ))}
                        </tr>
                    );
                }})}
        </table>
        <KChart rawData={stockPrices.slice()}/>
    </div>
}
